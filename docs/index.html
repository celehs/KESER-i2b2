<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KESER Embedding Generation &amp; Evaluation • KESER.i2b2</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="KESER Embedding Generation &amp; Evaluation">
<meta property="og:description" content="This package is to generate &amp; evaluate embeddings from co-occurence data with given dimension range.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">KESER.i2b2</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="keser-i2b2">keser-i2b2<a class="anchor" aria-label="anchor" href="#keser-i2b2"></a>
</h1></div>
<p>This is a package to:</p>
<ul>
<li><p>Generate / Evaluate Embedding</p></li>
<li><p>Get Embedding Regression for Feature Selection</p></li>
</ul>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Your R version should be <code>&gt;= 3.3.0</code>. You can install the development version from GitHub with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"celehs/KESER-i2b2"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">KESER.i2b2</span><span class="op">)</span></span></code></pre></div>
<p>If you can’t install it, alternative option is to download the repo and use <code><a href="https://rdrr.io/pkg/devtools/man/load_all.html" class="external-link">devtools::load_all()</a></code> to load the package.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="st">"D:\\Projects\\harvard\\keser-i2b2"</span><span class="op">)</span>     <span class="co"># Set to your path</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/devtools/man/load_all.html" class="external-link">load_all</a></span><span class="op">(</span><span class="op">)</span>    </span></code></pre></div>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
</div>
<div class="section level2">
<h2 id="step-1-get-embedding-from-co-ocuurence-matrix">Step 1: Get Embedding from Co-ocuurence Matrix.<a class="anchor" aria-label="anchor" href="#step-1-get-embedding-from-co-ocuurence-matrix"></a>
</h2>
<p>Make sure you have the following files available:</p>
<ul>
<li><p><code>CO_file</code>: Co-occurrence matrix file.</p></li>
<li><p><code>freq_file</code>: Frequency Count file.</p></li>
</ul>
<p><strong>Note:</strong> The format of files can be <code>.csv</code>, <code>.parquet</code> or <code>.Rdata</code>.</p>
<p><strong>Note:</strong> If <code>use.dataframe = TRUE</code> then these two should be passed with R dataframes, other than file names.</p>
<div class="section level3">
<h3 id="input-file-data-structure-examples">Input File Data Structure Examples<a class="anchor" aria-label="anchor" href="#input-file-data-structure-examples"></a>
</h3>
<div class="section level4">
<h4 id="co-occurrence-matrix-file-co_file">Co-occurrence matrix file (<code>CO_file</code>):<a class="anchor" aria-label="anchor" href="#co-occurrence-matrix-file-co_file"></a>
</h4>
<div class="sourceCode" id="cb3"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 10 x 3</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    index1 index2 count</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1   1856   3004     1</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2    671   8332    10</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3   4737   4967    79</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4    572   9233     1</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5   1438   5749     3</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6   1165   9479     1</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7    114   3907    51</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8   8752   9185   273</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9    587   9001    20</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10   1175   3675    46</span></span></code></pre></div>
<p>Columsn in order: <code>index1</code>, <code>index2</code>, <code>count</code>. The first two columns are the location indexes of code. The third column is the count of the code pair.</p>
</div>
<div class="section level4">
<h4 id="frequency-counts-file-freq_file">Frequency counts file (<code>freq_file</code>):<a class="anchor" aria-label="anchor" href="#frequency-counts-file-freq_file"></a>
</h4>
<div class="sourceCode" id="cb4"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 10 x 4</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    index code    description                                             freq_~1</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;                                                     &lt;dbl&gt;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1     1 CCS:1   incision and excision of cns                               1577</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2     2 CCS:10  thyroidectomy, partial or complete                          759</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3     3 CCS:100 endoscopy and endoscopic biopsy of the urinary tract      10303</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4     4 CCS:101 transurethral excision, drainage, or removal urinary o~    5978</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5     5 CCS:102 ureteral catheterization                                   5258</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6     6 CCS:103 nephrotomy and nephrostomy                                 1517</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7     7 CCS:104 nephrectomy, partial or complete                            573</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8     8 CCS:105 kidney transplant                                           132</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9     9 CCS:106 genitourinary incontinence procedures                       631</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10    10 CCS:107 extracorporeal lithotripsy, urinary                        2229</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ... with abbreviated variable name 1: freq_count</span></span></code></pre></div>
<p>Columns in order: <code>index</code>, <code>code</code>, <code>description</code>, <code>freq_count</code>. The first column is the location index of code, the second column is the name of code, the third column is the description of code, the fourth column is the frequency count of code.</p>
<p><strong>Note</strong>: All values in columns <code>index1</code> and <code>index2</code> of <code>CO_file</code> should also be covered in column <code>index</code> of <code>freq_file</code>. Due to size limitation, data examples above are only a small snippet of full data, hence it can <strong>NOT</strong> serve as running examples!</p>
</div>
</div>
<div class="section level3">
<h3 id="set-up-parameters">Set up Parameters<a class="anchor" aria-label="anchor" href="#set-up-parameters"></a>
</h3>
<p>For the file paths, change it base on your file locations. You can tune the dimensions on variable <code>dims</code>. The output files (<code>.Rdata</code> file &amp; report file) will be saved at <code>out_dir</code>. If <code>out_dir = NULL</code>, it will create a folder called <code>output</code> and put it there.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CO_file</span> <span class="op">&lt;-</span> <span class="st">"dungeon//data//AD_cooccurence_result_1019.csv"</span>          <span class="co"># Co-occurrence File: .csv/.parquet/.Rdata</span></span>
<span><span class="va">freq_file</span> <span class="op">&lt;-</span> <span class="st">"dungeon//data//AD_freq_file.csv"</span>                      <span class="co"># Frequency File: .csv/.parquet/.Rdata</span></span>
<span><span class="va">dims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">1000</span>, <span class="fl">200</span><span class="op">)</span>                                         <span class="co"># Dimension Setting</span></span>
<span><span class="va">out_dir</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>                                                     <span class="co"># Output folder setting -  If NULL All Outputs Will Be At: working_dir/output</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="generate-embedding--evaluation">Generate Embedding &amp; Evaluation<a class="anchor" aria-label="anchor" href="#generate-embedding--evaluation"></a>
</h3>
<p>The <code>freq_file</code> is used to map the codes from indexes, map the description and remove codes with low frequency in order to reduce the time cost. The default cutoff is set to <strong>1000</strong>. To change the cutoff, please refer to documents of function <code>get_eval_embed</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_eval_embed.html">get_eval_embed</a></span><span class="op">(</span>CO_file <span class="op">=</span> <span class="va">CO_file</span>,</span>
<span>                          freq_file <span class="op">=</span> <span class="va">freq_file</span>,</span>
<span>                          dims <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">1000</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>                          out_dir <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> </span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="other-parameters">Other parameters:<a class="anchor" aria-label="anchor" href="#other-parameters"></a>
</h2>
<p><code>dims</code>: A vector of numeric values for dimension, by default is <code>seq(100, 1000, 100)</code>.</p>
<p><code>out_dir</code>: The output folder to save results. By default is a folder call <code>output</code> under your current working directory. If not exists(NULL) it’ll generate it automatically.</p>
<p><code>freq_min</code>: The frequency counts cutoff for code filtering. If the counts are less than <code>freq_min</code>, it’ll be filtered out. By default is <code>1000</code>.</p>
<p><code>threshold</code>: Integer number, the threshold to get SPPMI matrix, by default is <code>10</code>.</p>
<p><code>normalize</code>: <code>TRUE</code> or <code>FALSE</code>, to normalize embedding or not. By default is <code>True</code>.</p>
<p>Example codes of all default input parameters:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_eval_embed.html">get_eval_embed</a></span><span class="op">(</span>CO_file <span class="op">=</span> <span class="va">CO_file</span>,</span>
<span>                          freq_file <span class="op">=</span> <span class="va">freq_file</span>,</span>
<span>                          dims <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">1000</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>                          out_dir <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                          freq_min <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                          threshold <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                          normalize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span></code></pre></div>
<p>The output of <code>get_eval_embed</code> is a list includes meta-data, embedding &amp; evaluation results. The list will also be saved as <code>.Rdata</code>. It may take hours to run depending on your data size and hardware.</p>
<div class="section level4">
<h4 id="generate-plot-report">Generate Plot Report<a class="anchor" aria-label="anchor" href="#generate-plot-report"></a>
</h4>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/get_report.html">get_report</a></span><span class="op">(</span><span class="va">summary</span>, plot_val <span class="op">=</span> <span class="st">"auc"</span>, knit_format <span class="op">=</span> <span class="st">"html"</span><span class="op">)</span></span></code></pre></div>
<p><code>get_report</code> will not return anything but creates the plot report under <code>out_dir</code> folder. If <code>out_dir</code> is <code>NULL</code> then it will create a folder called <strong>output</strong> in your working directly.</p>
</div>
<div class="section level4">
<h4 id="summary-object">Summary Object<a class="anchor" aria-label="anchor" href="#summary-object"></a>
</h4>
<p>The summary object includes <code>meta_data</code> and <code>summary</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">summary</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><code>summary$meta_data</code> has the meta information. Inside the <code>summary$summary</code>, the next level is dimension value. Inside each dimension, there are <code>evaluation</code> and <code>embedding</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">summary</span><span class="op">$</span><span class="va">meta_data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">summary</span><span class="op">$</span><span class="va">summary</span><span class="op">$</span><span class="va">`100`</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Let’s say you picked want to pick <code>dim=100</code> from the summary. this is the way to retrieve it:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_embed</span> <span class="op">&lt;-</span> <span class="va">summary</span><span class="op">$</span><span class="va">summary</span><span class="op">$</span><span class="va">`100`</span><span class="op">$</span><span class="va">embedding</span></span>
<span><span class="va">my_evaluation</span> <span class="op">&lt;-</span> <span class="va">summary</span><span class="op">$</span><span class="va">summary</span><span class="op">$</span><span class="va">`100`</span><span class="op">$</span><span class="va">evaluation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">my_embed</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">my_evaluation</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="retrieve-best-embedding">Retrieve Best Embedding<a class="anchor" aria-label="anchor" href="#retrieve-best-embedding"></a>
</h4>
<p>By default the best embedding is picking from the best <code>roc</code> with weighted relative (<code>weighted.rela</code>). You can change the setting in the function, please refer to the function documentation for more info.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">best</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_best_dim.html">get_best_dim</a></span><span class="op">(</span><span class="va">summary</span><span class="op">)</span></span>
<span><span class="va">best_dim</span> <span class="op">&lt;-</span> <span class="va">best</span><span class="op">$</span><span class="va">dim</span></span>
<span><span class="va">best_embed</span> <span class="op">&lt;-</span> <span class="va">best</span><span class="op">$</span><span class="va">embedding</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">best_embed</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="check-results">Check Results<a class="anchor" aria-label="anchor" href="#check-results"></a>
</h4>
<p>The evaluation plots are saved as “Summary-XX-YY-ZZ.html”, and the original summary data are saved as “Summary-XX-YY-ZZ.Rdata”, where XX stands for starting dimension, YY stands for ending dimension and ZZ stands for Step.</p>
<p>You can choose a proper dimension and use the corresponding embedding for the next steps.</p>
</div>
</div>
<div class="section level2">
<h2 id="step-2-get-selected-features-with-embedding-regression">Step 2: Get Selected Features with Embedding Regression<a class="anchor" aria-label="anchor" href="#step-2-get-selected-features-with-embedding-regression"></a>
</h2>
<p>From above we know how to get the embedding from co-occurence matrix step by step. Further we’ll used the embedding to select related features for our interested PheCodes. Examples below will use <strong>RPDR</strong> data.</p>
<p>We recommend using 80% data to create a training co-occurence matrix and 20% data to create a validation co-occurrence matrix. Assume that you already have training/testing CO files and freq files named as <code>CO_train</code>/<code>CO_test</code> and <code>freq_file_train</code>/<code>freq_file_test</code>.</p>
<p>First, let’s get the embedding from training data.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get embedding &amp; evaluation</span></span>
<span><span class="va">summary_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_eval_embed.html">get_eval_embed</a></span><span class="op">(</span>CO_file <span class="op">=</span> <span class="va">CO_train</span>, </span>
<span>                                freq_file <span class="op">=</span> <span class="va">freq_file_train</span>,</span>
<span>                                dims <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">1000</span>, <span class="fl">100</span><span class="op">)</span>, </span>
<span>                                out_dir <span class="op">=</span> <span class="st">"H:\\test"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get plot report (Optional)</span></span>
<span><span class="fu"><a href="reference/get_report.html">get_report</a></span><span class="op">(</span><span class="va">summary_train</span>, plot_val <span class="op">=</span> <span class="st">"auc"</span>, knit_format <span class="op">=</span> <span class="st">"html"</span><span class="op">)</span></span></code></pre></div>
<p>Second, let’s get the training embedding with <strong>best auc</strong> of weighted relative. We can the best dimension by accessing <code>best$dim</code> below.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get best embedding based on best auc by weighted relative</span></span>
<span><span class="va">best</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_best_dim.html">get_best_dim</a></span><span class="op">(</span><span class="va">summary_train</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">best</span><span class="op">$</span><span class="va">dim</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get training &amp; testing embedding based on best dimension</span></span>
<span><span class="va">embed_train</span> <span class="op">&lt;-</span> <span class="va">best</span><span class="op">$</span><span class="va">embedding</span></span>
<span><span class="va">embed_valid</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_best_dim.html">get_best_dim</a></span><span class="op">(</span><span class="fu"><a href="reference/get_eval_embed.html">get_eval_embed</a></span><span class="op">(</span>CO_file <span class="op">=</span> <span class="va">CO_test</span>, </span>
<span>                                           freq_file <span class="op">=</span> <span class="va">freq_file_test</span>,</span>
<span>                                           dims <span class="op">=</span> <span class="va">best</span><span class="op">$</span><span class="va">dim</span>, </span>
<span>                                           out_dir <span class="op">=</span> <span class="va">out_dir</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="st">"embedding"</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p>Third, perform <strong>glmnet</strong> regression model based on embedding to get the related features (codes) for interested PheCodes Let’s assume your interested PheCodes are <code>PheCode:714.1</code>, <code>PheCode:250.2</code> and <code>PheCode:278.1</code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get regression for embeding to select related codes</span></span>
<span><span class="va">phecodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PheCode:714.1"</span>, <span class="st">"PheCode:250.2"</span>, <span class="st">"PheCode:278.1"</span><span class="op">)</span>   <span class="co"># your interested PheCodes</span></span>
<span><span class="va">lambda_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">51</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1e-6</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">60</span>, <span class="fl">1000</span>, <span class="fl">50</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1e-6</span><span class="op">)</span>    <span class="co"># the lambda candidates for glmnet, this is also the default value.</span></span>
<span><span class="va">alpha</span> <span class="op">=</span> <span class="fl">0.25</span>    <span class="co"># alpha value for glmnet</span></span>
<span><span class="va">regression_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_embed_regression.html">get_embed_regression</a></span><span class="op">(</span>embed_train <span class="op">=</span> <span class="va">embed_train</span>, </span>
<span>                                           embed_valid <span class="op">=</span> <span class="va">embed_valid</span>, </span>
<span>                                           phecodes <span class="op">=</span> <span class="va">phecodes</span>,</span>
<span>                                           dim <span class="op">=</span> <span class="va">best</span><span class="op">$</span><span class="va">dim</span>,</span>
<span>                                           lambda_vec <span class="op">=</span> <span class="va">lambda_vec</span>,</span>
<span>                                           alpha <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span></span></code></pre></div>
<p>Then, you can access the results in <code>regression_summary</code>.</p>
<p><code>regression_summary$summary_data</code> is the selected features with beta’s, cosine values &amp; descriptions for interested PheCode.</p>
<p><code>regression_summary$Nlist</code> is the number of non-zero betas for each lambda selected.</p>
<p><code>regression_summary$min_lambdas</code> is the lambda selected for minimum AIC + testing residuals.</p>
<p><code>regression_summary$eval_plots</code> is the evaluation plots of testing residual over lambda.</p>
<p><code>regression_summary$wordcloud_plots</code> is the word cloud plot magnified by cosine value, which indicates the relatedness of codes to the interested PheCode.</p>
<p><code>regression_summary$selected_features</code> is the selected features of <code>summary_data</code> filtered by <code>beta == 0</code></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">regression_summary</span><span class="op">$</span><span class="va">summary_data</span><span class="op">$</span><span class="va">`PheCode:714.1`</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">regression_summary</span><span class="op">$</span><span class="va">Nlist</span><span class="op">$</span><span class="va">`PheCode:714.1`</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">regression_summary</span><span class="op">$</span><span class="va">min_lambdas</span><span class="op">$</span><span class="va">`PheCode:714.1`</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">regression_summary</span><span class="op">$</span><span class="va">eval_plots</span><span class="op">$</span><span class="va">`PheCode:714.1`</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">regression_summary</span><span class="op">$</span><span class="va">wordcloud_plots</span><span class="op">$</span><span class="va">`PheCode:714.1`</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">regression_summary</span><span class="op">$</span><span class="va">selected_features</span><span class="op">$</span><span class="va">`PheCode:714.1`</span><span class="op">)</span></span></code></pre></div>
<p><strong>Warning:</strong> The evaluation plots of <strong>Test set + AIC</strong> should be <strong>U Curve</strong>. Otherwise it’s not correct. If the U Curve does not occur, tune the <code>lambda_vec</code> and <code>alpha</code> to and repeat the step 2 again. Given that the <strong>lambda_vec</strong> is highly data specific, it’s very likely that you need to tune it by yourself.</p>
<p>Example of Valid Evaluation (U Shape) :</p>
<p><img src="reference/figures/valid_regression.png"> </p>
<p>Example of Invalid Evaluation Plot (Non-U Shape):</p>
<p><img src="reference/figures/invalid_regression.png"> </p>
<p>See the <a href="https://celehs.github.io/KESER-i2b2/" class="external-link">Documentation</a> to learn more.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing KESER.i2b2</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>The package maintainer <br><small class="roles"> Maintainer </small>  </li>
</ul>
</div>



  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by The package maintainer.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
